{% extends 'base.html' %}
{% block title %}{{ trabajo.nombre_cliente }} {{ trabajo.apellido_cliente or '' }}{% endblock %}

{% block content %}
{% from "components/page_header.html" import page_header %}

{{ page_header(
    title="",
    breadcrumbs=[
        {"text": "Coinpla", "bold": true},
        {"text": trabajo.nombre_cliente ~ " " ~ (trabajo.apellido_cliente or ''), "bold": true}
    ],
    separator_bold=true
) }}

<div class="container mb-5">
  <div class="row">
    <!-- Columna principal con detalles del trabajo -->
    <div class="col-lg-8">
      <div class="card shadow-sm" style="border-radius: 1rem; border: 1px solid #cbc6c6; overflow: hidden;">
        <!-- Encabezado con datos principales -->
        <div class="card-header d-flex align-items-center gap-2" style="background-color: #f9f9f9; border-bottom: 1px solid #cbc6c6;">
          <i class="bi bi-info-circle" style="font-size: 1rem; color: #6c757d;"></i>
          <span style="font-size: 1rem; color: #6c757d; font-weight: 500;">Información del Servicio</span>
        </div>
        
        <!-- Información organizada en secciones -->
        <div class="card-body">
          <!-- Datos del cliente -->
          <div class="mb-4">
            <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-person me-2"></i>Información del Cliente</h6>
            <dl class="row mb-0">
              <dt class="col-sm-4">Nombre:</dt>
              <dd class="col-sm-8">{{ trabajo.nombre_cliente }} {{ trabajo.apellido_cliente or '' }}</dd>

              {% if trabajo.telefono %}
              <dt class="col-sm-4">Teléfono:</dt>
              <dd class="col-sm-8">{{ trabajo.telefono }}</dd>
              {% endif %}
            </dl>
          </div>

          <!-- Datos de localización -->
          <div class="mb-4">
            <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-geo-alt me-2"></i>Ubicación</h6>
            <dl class="row mb-0">
              <dt class="col-sm-4">Dirección:</dt>
              <dd class="col-sm-8">{{ trabajo.direccion }}</dd>

              {% if trabajo.codigo_postal %}
              <dt class="col-sm-4">Código Postal:</dt>
              <dd class="col-sm-8">{{ trabajo.codigo_postal }}</dd>
              {% endif %}
            </dl>
          </div>
          
          <!-- Detalles del servicio -->
          <div class="mb-4">
            <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-tools me-2"></i>Detalles del Servicio</h6>
            <dl class="row mb-0">
              <dt class="col-sm-4">Fecha:</dt>
              <dd class="col-sm-8">{{ trabajo.fecha.strftime('%d/%m/%Y') }}</dd>

              <dt class="col-sm-4">Hora:</dt>
              <dd class="col-sm-8">{{ trabajo.hora }}</dd>
              
              <dt class="col-sm-4">Descripción:</dt>
              <dd class="col-sm-8">{{ trabajo.descripcion }}</dd>

              <dt class="col-sm-4">Técnico:</dt>
              <dd class="col-sm-8">{% if trabajo.technician %}{{ trabajo.technician.nombre }} {{ trabajo.technician.apellido or '' }}{% else %}Sin asignar{% endif %}</dd>

              <dt class="col-sm-4">Cantidad:</dt>
              <dd class="col-sm-8">{{ trabajo.cantidad|default('N/A', true) }}{% if trabajo.cantidad %} €{% endif %}</dd>
              
              <dt class="col-sm-4">Duración:</dt>
              <dd class="col-sm-8">
                {% if trabajo.duracion == 'corta' %}
                  Corta (1 hora)
                {% elif trabajo.duracion == 'media' %}
                  Media (2 horas)
                {% elif trabajo.duracion == 'larga' %}
                  Larga (3 horas)
                {% else %}
                  {{ trabajo.duracion }}
                {% endif %}
              </dd>
            </dl>
          </div>
        </div>
        
        <!-- Acciones disponibles -->
        <div class="card-footer d-flex gap-2 justify-content-center" style="background-color: #f9f9f9; border-top: 1px solid #cbc6c6;">
          <a href="{{ url_for('jobs.listar_trabajos') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left me-1"></i> Volver
          </a>
          
          {% if trabajo.estado == 'Completado' %}
          <button type="button" class="btn btn-success" style="opacity: 0.65; pointer-events: none;" title="Esta función estará disponible próximamente">
            <i class="bi bi-receipt me-1"></i> Ver Factura
          </button>
          {% endif %}
          
          <button type="button" class="btn btn-info" style="opacity: 0.65; pointer-events: none;" title="Esta función estará disponible próximamente">
            <i class="bi bi-file-earmark-text me-1"></i> Ver Presupuesto
          </button>
        </div>
      </div>
    </div>
    
    <!-- Columna secundaria con información adicional -->
    <div class="col-lg-4 mt-4 mt-lg-0">
      <!-- Resumen del trabajo - Con estado resaltado -->
      <div class="card shadow-sm mb-4" style="border-radius: 1rem; border: 1px solid #cbc6c6; overflow: hidden;">
        <div class="card-header d-flex align-items-center gap-2" style="background-color: #f9f9f9; border-bottom: 1px solid #cbc6c6; border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
          <i class="bi bi-clipboard-data" style="font-size: 1rem; color: #6c757d;"></i>
          <span style="font-size: 1rem; color: #6c757d; font-weight: 500;">Resumen</span>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
              <span>ID del Trabajo:</span>
              <span class="badge rounded-pill bg-primary">{{ trabajo.id }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
              <span>Estado:</span>
              <!-- Estado resaltado con colores y diseño mejorado - Verde más llamativo para Completado -->
              <span class="badge rounded-pill fw-semibold fs-6 px-3 py-2" 
                style="background-color: {{ 
                  '#FFA726' if trabajo.estado == 'Pendiente' else 
                  '#2E7D32' if trabajo.estado == 'Completado' else 
                  '#2196F3' if trabajo.estado == 'En Proceso' else
                  '#757575' 
                }}; color: white; box-shadow: {{ 
                  '0 3px 6px rgba(46,125,50,0.3)' if trabajo.estado == 'Completado' else 
                  '0 2px 4px rgba(0,0,0,0.1)'
                }};">
                {{ trabajo.estado }}
              </span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
              <span>Fecha:</span>
              <span>{{ trabajo.fecha.strftime('%d/%m/%Y') }}</span>
            </li>
          </ul>
        </div>
      </div>
      
      <!-- Acciones rápidas -->
      <div class="card shadow-sm" style="border-radius: 1rem; border: 1px solid #cbc6c6; overflow: hidden;">
        <div class="card-header d-flex align-items-center gap-2" style="background-color: #f9f9f9; border-bottom: 1px solid #cbc6c6; border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
          <i class="bi bi-lightning" style="font-size: 1rem; color: #6c757d;"></i>
          <span style="font-size: 1rem; color: #6c757d; font-weight: 500;">Acciones Rápidas</span>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            {% if trabajo.estado != 'Completado' %}
            <form method="POST" action="{{ url_for('jobs.completar_trabajo', id=trabajo.id) }}">
              <button type="submit" class="btn btn-success btn-block w-100 action-button">
                <i class="bi bi-check-circle me-1"></i> Marcar como Completado
              </button>
            </form>
            {% endif %}
            
            <button type="button" class="btn btn-primary btn-block w-100 action-button" onclick="window.print();" style="display: block !important; visibility: visible !important;">
              <i class="bi bi-printer me-1"></i> Imprimir Detalles
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Estilos adicionales para impresión y botones -->
<style>
  @media print {
    .navbar, .sidebar, .card-header, .card-footer, .breadcrumb, .btn, .col-lg-4 {
      display: none !important;
    }
    
    body {
      font-size: 12pt;
    }
    
    .card {
      border: none !important;
      box-shadow: none !important;
    }
    
    .card-body {
      padding: 0 !important;
    }
    
    .container {
      width: 100% !important;
      max-width: 100% !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    
    h6 {
      font-size: 14pt;
      margin-top: 20pt;
    }
    
    .status {
      border: 1px solid #333;
      background-color: transparent !important;
      color: #333 !important;
    }
  }
  
  /* Estilos para asegurar visibilidad de botones */
  .btn-primary, 
  .btn-secondary,
  .btn-success,
  .btn-info {
    display: inline-block !important;
    visibility: visible !important;
  }

  /* Estilos específicos para el botón de impresión */
  button[onclick*="print"] {
    display: block !important;
    visibility: visible !important;
    background-color: #0d6efd !important;
    color: white !important;
  }

  /* Estilos para botones deshabilitados */
  .btn:disabled, .btn[disabled] {
    opacity: 0.65;
    cursor: not-allowed;
    pointer-events: none;
  }
  
  /* Estilos específicos para el estado Completado */
  .status-paid {
    background-color: #d4edda !important;
    color: #155724 !important;
    font-weight: 600 !important;
  }
  
  /* Añadir un pequeño icono de check para el estado completado */
  .status-paid::before {
    content: "✓ ";
  }
  
  /* Estilos para los botones de acción en la página de detalles */
  .action-button {
    border-radius: 1rem !important; /* Mismo redondeo que los contenedores */
    padding: 0.75rem 1.25rem !important; /* Padding más amplio para mejor apariencia */
    font-weight: 500 !important;
    transition: transform 0.3s ease, box-shadow 0.3s ease !important;
    border: none !important; /* Eliminar borde */
    box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important; /* Sombra sutil */
  }
  
  .action-button:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
  }
  
  .action-button:active {
    transform: translateY(0) !important;
    box-shadow: 0 2px 3px rgba(0,0,0,0.1) !important;
  }
</style>
{% endblock %}
