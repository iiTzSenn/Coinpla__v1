{% extends 'base.html' %}
{% block title %}Dashboard Administrador - Coinpla{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- =========================================
       RUTA DE LA PÁGINA
       ========================================= -->
  <div class="mb-3">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item" style="font-weight: bold;">Coinpla</li>
        <li class="breadcrumb-item active" aria-current="page" style="font-weight: bold;">Inicio</li>
      </ol>
    </nav>
  </div>

  <!-- =========================================
       1. TARJETAS KPI (Indicadores Clave)
       ========================================= -->
  <div class="row g-3 mb-4">
    <!-- Trabajos totales -->
    <div class="col-md-3">
      <div class="card dashboard-card bg-success trabajos">
        <div class="card-body">
          <h5 class="card-title">Trabajos Totales</h5>
          <p class="card-text fs-4">{{ total_trabajos }}</p>
        </div>
      </div>
    </div>
    <!-- Pendientes -->
    <div class="col-md-3">
      <div class="card dashboard-card bg-warning pendientes">
        <div class="card-body">
          <h5 class="card-title">Pendientes</h5>
          <p class="card-text fs-4">{{ trabajos_pendientes }}</p>
        </div>
      </div>
    </div>
    <!-- Completados -->
    <div class="col-md-3">
      <div class="card dashboard-card bg-danger completados">
        <div class="card-body">
          <h5 class="card-title">Completados</h5>
          <p class="card-text fs-4">{{ trabajos_completados }}</p>
        </div>
      </div>
    </div>
    <!-- Facturación -->
    <div class="col-md-3">
      <div class="card dashboard-card bg-info facturacion">
        <div class="card-body">
          <h5 class="card-title">Facturación</h5>
          <p class="card-text fs-4">€ {{ facturacion_total|default("0.00") }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================================
       2. GRÁFICAS
       ========================================= -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card" style="border-radius: 1rem; border: 1px solid #cbc6c6;">
        <div class="card-header d-flex align-items-center gap-2" style="border-radius: 1rem 1rem 0 0; background-color: #f9f9f9 !important; border-bottom: 1px solid #cbc6c6;">
          <i class="bi bi-bar-chart" style="font-size: 0.9rem; color: #6c757d;"></i>
          <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500;">Trabajos</span>
        </div>
        <div class="card-body" style="height: 250px;"> <!-- Altura reducida -->
          <canvas id="trabajosLineChart"></canvas>
        </div>
      </div>
    </div>
  </div>
      
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card" style="border-radius: 1rem; border: 1px solid #cbc6c6;">
        <div class="card-header d-flex align-items-center gap-2" style="border-radius: 1rem 1rem 0 0; background-color: #f9f9f9 !important; border-bottom: 1px solid #cbc6c6;">
          <i class="bi bi-bar-chart" style="font-size: 0.9rem; color: #6c757d;"></i>
          <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500;">Facturación Mensual</span>
        </div>
        <div class="card-body" style="height: 300px;">
          <canvas id="facturacionBarChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card" style="border-radius: 1rem; border: 1px solid #cbc6c6;">
        <div class="card-header d-flex align-items-center gap-2" style="border-radius: 1rem 1rem 0 0; background-color: #f9f9f9 !important; border-bottom: 1px solid #cbc6c6;">
          <i class="bi bi-bar-chart" style="font-size: 0.9rem; color: #6c757d;"></i>
          <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500;">Trabajos Pendientes</span>
        </div>
        <div class="card-body" style="height: 300px;">
          <canvas id="trabajosPendientesBarChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- PASO DE DATOS A JAVASCRIPT (Variables Globales) -->
  <script>
    var mesesLabels = {{ meses_labels|default([])|tojson }};
    var trabajosMes = {{ trabajos_mes|default([])|tojson }};
    var facturacionMes = {{ facturacion_mes|default([])|tojson }};
    var trabajosPendientesMes = {{ trabajosPendientesMes|default([])|tojson }}; <!-- Corregido -->
    var trabajosPendientes = {{ trabajos_pendientes|default(0) }};
    var trabajosEnProceso = {{ trabajos_en_proceso|default(0) }};
    var trabajosCompletados = {{ trabajos_completados|default(0) }};
    var eventosCalendario = {{ eventos_calendario|default([])|tojson }};
  </script>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- FullCalendar -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
<!-- Tu archivo JS externo -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
