{% extends 'base.html' %}
{% block title %}Dashboard - Admin{% endblock %}

{% block content %}
{% from "components/page_header.html" import page_header %}
{% from "components/dashboard_cards.html" import stats_row, chart_card %}

{{ page_header(
    title="",
    breadcrumbs=[
        {"text": "Inicio"}
    ]
) }}

<!-- Estad√≠sticas principales -->
{{ stats_row([
    {"value": num_trabajos, "label": "Trabajos Totales", "type": "trabajos", "icon": "üõ†Ô∏è"},
    {"value": num_trabajos_pendientes, "label": "Trabajos en Proceso", "type": "pendientes", "icon": "‚è∞"},
    {"value": num_trabajos_completados, "label": "Trabajos Completados", "type": "completados", "icon": "‚úî"},
    {"value": facturacion_total, "label": "Facturaci√≥n Total", "type": "facturacion", "icon": "üí∞"}
]) }}

<!-- Gr√°fico principal de l√≠neas -->
<div class="row" style="margin-bottom: 1.75rem;">
  <div class="col-12">
    <div class="card" style="border-radius: 1rem; border: 1px solid #cbc6c6;">
      <div class="card-header d-flex align-items-center gap-2" style="background-color: #f9f9f9; border-bottom: 1px solid #cbc6c6; border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
        <i class="bi bi-graph-up" style="font-size: 0.9rem; color: #6c757d;"></i>
        <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500;">Trabajos por Mes</span>
      </div>
      <div class="card-body">
        <canvas id="trabajosLineChart" style="width: 100%; height: 200x;"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Gr√°ficos secundarios -->
<div class="row mb-4" style="margin-top: 1.75rem;">
  <div class="col-md-4 pe-md-3">
    <div class="card" style="border-radius: 1rem; border: 1px solid #cbc6c6; margin-left: 0; width: 100%;">
      <div class="card-header d-flex align-items-center gap-2" style="background-color: #f9f9f9; border-bottom: 1px solid #cbc6c6; border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
        <i class="bi bi-person-check" style="font-size: 0.9rem; color: #6c757d;"></i>
        <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500;">T√©cnicos y trabajos</span>
      </div>
      <div class="card-body d-flex justify-content-center">
        <div style="width: 100%; height: 200px; position: relative; max-width: 300px;">
          <canvas id="distribucionChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-8 ps-md-3">
    <div class="card" style="border-radius: 1rem; border: 1px solid #cbc6c6;">
      <div class="card-header d-flex align-items-center gap-2" style="background-color: #f9f9f9; border-bottom: 1px solid #cbc6c6; border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
        <i class="bi bi-currency-dollar" style="font-size: 0.9rem; color: #6c757d;"></i>
        <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500;">Facturaci√≥n</span>
      </div>
      <div class="card-body">
        <canvas id="facturacionBarChart" style="width: 100%; height: 200px;"></canvas>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script>
  var mesesLabels = {{ meses_labels|default([])|tojson }};
  var trabajosMes = {{ trabajos_mes|default([])|tojson }};
  var facturacionMes = {{ facturacion_mes|default([])|tojson }};
  var trabajosPendientesMes = {{ trabajosPendientesMes|default([])|tojson }};
  var trabajosPendientes = {{ num_trabajos_pendientes|default(0)|tojson }};
  var trabajosEnProceso = {{ num_trabajos_en_proceso|default(0)|tojson }};
  var trabajosCompletados = {{ num_trabajos_completados|default(0)|tojson }};
  var datosTecnicos = {{ datos_tecnicos|default([])|tojson }};
  
  // Para depuraci√≥n
  console.log("Datos de t√©cnicos:", datosTecnicos);
</script>
{% endblock %}
